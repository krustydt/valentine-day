<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>For Astha</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            --cherry: #d63031;
            --soft-pink: #fff5f5;
            --text-main: #2d3436;
        }

        * { box-sizing: border-box; touch-action: none; margin: 0; padding: 0; }

        body {
            font-family: 'Inter', sans-serif;
            background-color: #f1f2f6;
            height: 100vh;
            display: flex; justify-content: center; align-items: center;
            overflow: hidden;
        }

        #game-container {
            position: relative;
            width: 100%;
            max-width: 400px;
            height: 100vh;
            background: var(--soft-pink);
            overflow: hidden;
            box-shadow: 0 20px 50px rgba(0,0,0,0.1);
        }

        .bg-emoji { 
            position: absolute; 
            opacity: 0.15; 
            z-index: 1; 
            font-size: 18px; 
            pointer-events: none;
            user-select: none;
            transition: all 0.5s ease;
        }

        canvas { display: block; position: relative; z-index: 5; }

        .overlay {
            position: absolute; inset: 0;
            background: var(--soft-pink);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            z-index: 100; padding: 40px; text-align: center;
        }

        .hidden { display: none !important; }

        h1 { font-weight: 600; font-size: 1.4rem; margin-bottom: 12px; color: var(--text-main); }
        p { font-size: 0.9rem; color: #636e72; line-height: 1.6; margin-bottom: 30px; }

        /* UI Bar */
        .ui-top { position: absolute; top: 50px; width: 70%; left: 15%; z-index: 10; }
        .bar-bg { height: 6px; background: #ffe0e0; border-radius: 10px; overflow: hidden; margin-bottom: 8px; }
        #bar-fill { height: 100%; width: 0%; background: var(--cherry); transition: width 0.3s ease; }
        #status-text { font-size: 0.7rem; font-weight: 700; color: var(--cherry); letter-spacing: 0.1em; text-align: center; }

        .btn {
            background: #2d3436; color: white; border: none;
            padding: 14px 32px; border-radius: 6px;
            font-size: 0.85rem; font-weight: 600; cursor: pointer;
        }

        /* Error Screen */
        #screen-prank h1 { color: #d63031; font-family: monospace; font-size: 1.8rem; }
        #screen-prank p { color: #b71c1c; font-family: monospace; font-weight: bold; }
        .btn-retry { background: #d63031; }

        /* Minor Glitch Shake */
        .glitch-active { animation: minor-shake 0.1s infinite; }
        @keyframes minor-shake {
            0% { transform: translate(0, 0); }
            25% { transform: translate(1.5px, -1.5px); }
            50% { transform: translate(-1px, 1px); }
            75% { transform: translate(1px, 1.5px); }
            100% { transform: translate(0, 0); }
        }

        #screen-repair { background: #fff5f5; color: #0f0; font-family: monospace; }
        .repair-bar-bg { width: 80%; height: 8px; border: 1px solid #0f0; margin: 20px 0; }
        #repair-fill { width: 0%; height: 100%; background: #0f0; }

        .fake-popup {
            position: absolute; background: #fff; border: 2px solid #000;
            padding: 8px; font-size: 10px; font-family: monospace;
            z-index: 200; box-shadow: 4px 4px 0px #000; color: #d63031;
        }
    </style>
</head>
<body>

<div id="game-container">
    <div id="emoji-field"></div>

    <div class="ui-top" id="game-ui">
        <div class="bar-bg"><div id="bar-fill"></div></div>
        <div id="status-text">CATCH 30 CHERRIES</div>
    </div>

    <div id="screen-start" class="overlay">
        <h1 style="font-size: 2.5rem; margin-bottom: 10px;">üçí</h1>
        <h1>Hi Astha.</h1>
        <p>I'm feeling a bit "crumby" today.<br>Help the muffin catch 30 cherries?</p>
        <button class="btn" style="background:var(--cherry)" onclick="startGame()">Start</button>
    </div>

    <div id="screen-prank" class="overlay hidden">
        <h1>MISSION FAILED</h1>
        <p id="prank-msg">CRITICAL BAKE ERROR</p>
        <button class="btn btn-retry" onclick="retryPrank()">Retry Attempt</button>
    </div>

    <div id="screen-repair" class="overlay hidden">
        <p>RECOVERING BATCH...</p>
        <div class="repair-bar-bg"><div id="repair-fill"></div></div>
        <p id="repair-status" style="font-size: 0.6rem;">Fixing flour.dll...</p>
    </div>

    <div id="screen-final" class="overlay hidden">
        <h1 style="font-size: 2.5rem; margin-bottom: 10px;">üßÅ</h1>
        <h1>Perfect Batch!</h1>
        <p>You‚Äôre really the "yeast" I could do.<br><strong>Will you be my Valentine?</strong></p>
        <div style="display: flex; flex-direction: column; gap: 10px; width: 100%;">
            <button class="btn" style="background:var(--cherry)" onclick="showWin()">I'd be "muffin" without you</button>
            <button class="btn" style="background:transparent; border:1px solid #ccc; color:#666;" onclick="showWin()">Wheat-ever you say!</button>
        </div>
    </div>

    <div id="screen-win" class="overlay hidden">
        <h1 style="color: var(--cherry); font-size: 2.2rem;">Yay! ‚ù§Ô∏è</h1>
        <p>I'm so glad you said yes. I like you a "choco-lot."<br>Happy Valentine's Day, Astha.</p>
    </div>

    <canvas id="canvas"></canvas>
</div>

<script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const container = document.getElementById('game-container');
    const barFill = document.getElementById('bar-fill');
    
    let w, h, score = 0, gameRunning = false, prankCount = 0;
    let items = [];
    const prankMessages = ["ERR_OVERHEAT", "FLOUR_CORRUPTION", "FATAL_ERROR_SKILL_OVERFLOW"];

    const player = { x: 0, y: 0, size: 45 };

    // Strict Grid-Based Spacing
    function initBackground() {
        const field = document.getElementById('emoji-field');
        field.innerHTML = '';
        const emojis = ['üçí', 'üßÅ', '‚ú®', '‚ù§Ô∏è'];
        const gridRows = 8;
        const gridCols = 4;
        
        for(let r=0; r<gridRows; r++) {
            for(let c=0; c<gridCols; c++) {
                const span = document.createElement('span');
                span.className = 'bg-emoji';
                span.innerText = emojis[Math.floor(Math.random()*emojis.length)];
                
                // Each emoji is locked in a 20% width / 18% height box
                // We add a small random offset within that box so it doesn't look like a menu
                const leftPos = (c * 25) + 5 + (Math.random() * 10);
                const topPos = (r * 20) + 5 + (Math.random() * 8);
                
                span.style.left = leftPos + '%';
                span.style.top = topPos + '%';
                span.style.transform = `rotate(${Math.random()*30 - 15}deg)`;
                field.appendChild(span);
            }
        }
    }
    initBackground();

    function resize() {
        w = window.innerWidth > 400 ? 400 : window.innerWidth;
        h = window.innerHeight;
        canvas.width = w; canvas.height = h;
        player.y = h - 120; player.x = w / 2;
    }
    window.addEventListener('resize', resize);
    resize();

    function updateControl(clientX) {
        const rect = canvas.getBoundingClientRect();
        player.x = Math.max(35, Math.min(w - 35, clientX - rect.left));
    }

    canvas.addEventListener('mousemove', (e) => updateControl(e.clientX));
    canvas.addEventListener('touchmove', (e) => {
        e.preventDefault(); updateControl(e.touches[0].clientX);
    }, { passive: false });

    function drawMuffin(x, y, size) {
        ctx.save(); ctx.translate(x, y);
        ctx.fillStyle = '#d19a66'; ctx.beginPath();
        ctx.moveTo(-size/3, 0); ctx.lineTo(size/3, 0); ctx.lineTo(size/4, size/2); ctx.lineTo(-size/4, size/2); ctx.fill();
        ctx.fillStyle = '#e6b386'; ctx.beginPath(); ctx.arc(0, -2, size/2.2, Math.PI, 0); ctx.fill();
        ctx.fillStyle = '#d63031';
        [[-8,-6], [4,-12], [10,-4]].forEach(p => { ctx.beginPath(); ctx.arc(p[0], p[1], 3, 0, Math.PI*2); ctx.fill(); });
        ctx.restore();
    }

    function drawCherry(x, y, size) {
        ctx.save();
        ctx.strokeStyle = '#4a3728'; ctx.lineWidth = 1.5;
        ctx.beginPath(); ctx.moveTo(x, y - size + 2); ctx.quadraticCurveTo(x + 5, y - size - 8, x + 8, y - size - 5); ctx.stroke();
        const grad = ctx.createRadialGradient(x-2, y-2, 1, x, y, size);
        grad.addColorStop(0, '#ff4d4d'); grad.addColorStop(1, '#d63031');
        ctx.fillStyle = grad; ctx.beginPath(); ctx.arc(x, y, size, 0, Math.PI * 2); ctx.fill();
        ctx.fillStyle = 'rgba(255,255,255,0.4)'; ctx.beginPath(); ctx.arc(x-2, y-2, 2, 0, Math.PI*2); ctx.fill();
        ctx.restore();
    }

    function startGame() {
        document.getElementById('screen-start').classList.add('hidden');
        score = 0; barFill.style.width = "0%";
        gameRunning = true; gameLoop(); 
    }

    function retryPrank() {
        document.getElementById('screen-prank').classList.add('hidden');
        if (prankCount >= 3) {
            triggerGlitchSequence();
        } else {
            score = 0; barFill.style.width = "0%";
            gameRunning = true;
        }
    }

    function triggerGlitchSequence() {
        container.classList.add('glitch-active');
        document.getElementById('game-ui').classList.add('hidden');
        
        // Increased count and spread across the whole screen
        for(let i=0; i<20; i++) {
            setTimeout(() => {
                const pop = document.createElement('div');
                pop.className = 'fake-popup';
                // Random error codes
                const codes = ["CRITICAL_0x", "BAKE_ERR_", "MEMORY_LEAK_", "FLOUR_OFLW_"];
                pop.innerText = codes[Math.floor(Math.random()*codes.length)] + Math.random().toString(16).slice(2,5).toUpperCase();
                
                // Spread across the container
                pop.style.left = (Math.random() * 60 + 5) + "%";
                pop.style.top = (Math.random() * 80 + 10) + "%";
                // Randomize tilt for chaos
                pop.style.transform = `rotate(${Math.random() * 10 - 5}deg)`;
                
                container.appendChild(pop);
            }, i * 80); // Staggered pop-in
        }

        setTimeout(() => {
            container.classList.remove('glitch-active');
            document.querySelectorAll('.fake-popup').forEach(el => el.remove());
            triggerRepair();
        }, 2500); // Slightly longer glitch to enjoy the chaos
    }

    function triggerRepair() {
        const repairScreen = document.getElementById('screen-repair');
        const repairFill = document.getElementById('repair-fill');
        repairScreen.classList.remove('hidden');
        let p = 0;
        const interval = setInterval(() => {
            p += 2;
            repairFill.style.width = p + "%";
            if (p >= 100) {
                clearInterval(interval);
                setTimeout(() => {
                    repairScreen.classList.add('hidden');
                    document.getElementById('screen-final').classList.remove('hidden');
                }, 600);
            }
        }, 35);
    }

    function showWin() {
        document.getElementById('screen-final').classList.add('hidden');
        document.getElementById('screen-win').classList.remove('hidden');
        gameRunning = false;
        const end = Date.now() + 3000;
        (function frame() {
          confetti({ particleCount: 4, angle: 60, spread: 55, origin: { x: 0 }, colors: ['#d63031', '#ffffff'] });
          confetti({ particleCount: 4, angle: 120, spread: 55, origin: { x: 1 }, colors: ['#d63031', '#ffffff'] });
          if (Date.now() < end) requestAnimationFrame(frame);
        }());
    }

    function gameLoop() {
        ctx.clearRect(0, 0, w, h);
        if (gameRunning) {
            ctx.fillStyle = "rgba(0,0,0,0.15)";
            ctx.font = "600 11px Inter"; ctx.textAlign = "center";
            ctx.fillText("ASTHA", player.x, player.y - 35);
            drawMuffin(player.x, player.y, player.size);

            if (Math.random() < 0.04) {
                items.push({ x: Math.random() * (w - 70) + 35, y: -30, size: 8, speed: Math.random() * 0.5 + 2.5 });
            }

            for (let i = items.length - 1; i >= 0; i--) {
                let itm = items[i];
                itm.y += itm.speed;
                drawCherry(itm.x, itm.y, itm.size);
                if (Math.sqrt((itm.x - player.x)**2 + (itm.y - player.y)**2) < 32) {
                    items.splice(i, 1); 
                    score += (prankCount === 0 ? 1 : 2.5); 
                    barFill.style.width = Math.min(100, (score / 30) * 100) + "%";
                    if (score >= 30) {
                        gameRunning = false; prankCount++;
                        setTimeout(() => {
                            document.getElementById('prank-msg').innerText = prankMessages[prankCount-1] || "SYSTEM_FAILURE";
                            document.getElementById('screen-prank').classList.remove('hidden');
                        }, 400);
                    }
                } else if (itm.y > h + 30) items.splice(i, 1);
            }
        }
        requestAnimationFrame(gameLoop);
    }
</script>
</body>
</html>
